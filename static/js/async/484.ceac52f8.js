"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["484"],{5335(e,t,n){n.r(t),n.d(t,{Component:()=>S});var r=n(4848),s=n(6029),a=n(8623),i=n(156),l=n(7665),c=n(2454),d=n(6287),u=n(6380),o=n(1215),y=n(3133),p=n(400),m=n(5021),h=n(4840),x=n(8032),g=n(8424),A=n(2837),f=n(8361),j=n(6540),v=n(271),k=n(7762);let{Title:C}=d.A,w=e=>{let{value:t,onChange:n}=e,s=(0,j.useRef)(null),a=(0,j.useRef)(null);return(0,j.useEffect)(()=>(s.current&&!a.current&&(a.current=new v.uL({target:s.current,props:{content:{text:t},onChange:(e,t,r)=>{let{contentErrors:s}=r;!s&&("json"in e&&void 0!==e.json?n(JSON.stringify(e.json,null,2)):"text"in e&&n(e.text))},mode:"text"}})),()=>{a.current&&(a.current.destroy(),a.current=null)}),[]),(0,j.useEffect)(()=>{a.current&&a.current.update({text:t})},[t]),(0,r.jsx)("div",{ref:s,style:{height:300}})},S=()=>{let e=(0,l.jE)(),[t,n]=(0,j.useState)(!1),[d,v]=(0,j.useState)(null),[S]=u.A.useForm(),[N,b]=(0,j.useState)(""),{data:I,isLoading:O,refetch:J}=(0,c.I)({queryKey:["adminConfig"],queryFn:()=>k.i.getConfig()}),$=(null==I?void 0:I.data)?Object.entries(I.data).map(e=>{let[t,n]=e;return{key:t,value:n}}):[],F=async()=>{try{let t,r=(await S.validateFields()).key;try{t=JSON.parse(N)}catch{o.Ay.error("请输入有效的 JSON 格式");return}let s=JSON.stringify(t);await k.i.setConfig(r,s),o.Ay.success("保存成功"),n(!1),e.invalidateQueries({queryKey:["adminConfig"]})}catch(e){o.Ay.error(e.message)}},K=(0,j.useCallback)(async e=>{try{await k.i.deleteConfig(e),o.Ay.success("已删除"),J()}catch(e){o.Ay.error(e.message)}},[J]),R=[{title:"Key",dataIndex:"key",key:"key",width:200},{title:"Value",dataIndex:"value",key:"value",render:e=>{try{let t=JSON.parse(e);return(0,r.jsx)("pre",{className:"m-0 max-h-24 overflow-auto text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(t,null,2)})}catch{return(0,r.jsx)("span",{className:"text-gray-600",children:e})}}},{title:"操作",key:"action",width:150,render:(e,t)=>(0,r.jsxs)(y.A,{children:[(0,r.jsx)(p.Ay,{type:"link",onClick:()=>(e=>{v(e),S.setFieldsValue({key:e.key});try{b(JSON.stringify(JSON.parse(e.value),null,2))}catch{b(e.value)}n(!0)})(t),children:"编辑"}),(0,r.jsx)(m.A,{title:"确定删除此配置？",onConfirm:()=>K(t.key),children:(0,r.jsx)(p.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(s.A,{})})})]})}];return(0,r.jsxs)("div",{className:"page-section",children:[(0,r.jsxs)(h.A,{children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-4",children:[(0,r.jsx)(C,{level:4,className:"m-0!",children:"动态配置管理"}),(0,r.jsx)(p.Ay,{type:"primary",icon:(0,r.jsx)(a.A,{}),onClick:()=>{v(null),S.resetFields(),b(""),n(!0)},className:"w-full md:w-auto",children:"添加配置"})]}),(0,r.jsx)(x.A,{spinning:O,children:(0,r.jsx)(g.A,{dataSource:$,columns:R,rowKey:"key",pagination:!1,scroll:{x:720}})})]}),(0,r.jsx)(A.A,{title:d?"编辑配置":"添加配置",open:t,onCancel:()=>n(!1),footer:[(0,r.jsx)(p.Ay,{onClick:()=>n(!1),children:"取消"},"cancel"),(0,r.jsx)(p.Ay,{type:"primary",icon:(0,r.jsx)(i.A,{}),onClick:F,children:"保存"},"save")],width:700,children:(0,r.jsxs)(u.A,{form:S,layout:"vertical",children:[(0,r.jsx)(u.A.Item,{name:"key",label:"Key",rules:[{required:!0,message:"请输入配置键名"}],children:(0,r.jsx)(f.A,{disabled:!!d,placeholder:"配置键名"})}),(0,r.jsx)(u.A.Item,{label:"Value (JSON)",children:(0,r.jsx)(w,{value:N,onChange:b})})]})})]})}},7762(e,t,n){n.d(t,{i:()=>s});var r=n(6126);let s={getConfig:()=>(0,r.Ay)("get","/admin/config"),setConfig:(e,t)=>(0,r.Ay)("post","/admin/config",{key:e,value:t}),deleteConfig:e=>(0,r.Ay)("delete",`/admin/config/${e}`),searchUsers:e=>(0,r.Ay)("get",e?`/admin/users?search=${encodeURIComponent(e)}`:"/admin/users"),updateUser:(e,t)=>(0,r.Ay)("put",`/admin/users/${e}`,t),searchApps:e=>(0,r.Ay)("get",e?`/admin/apps?search=${encodeURIComponent(e)}`:"/admin/apps"),searchVersions:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.appId)&&t.set("appId",String(e.appId));let n=t.toString();return(0,r.Ay)("get",n?`/admin/versions?${n}`:"/admin/versions")},updateVersion:(e,t)=>(0,r.Ay)("put",`/admin/versions/${e}`,t),updateApp:(e,t)=>(0,r.Ay)("put",`/admin/apps/${e}`,t)}}}]);