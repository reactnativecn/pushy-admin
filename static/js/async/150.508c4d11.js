"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["150"],{6413(e,t,s){s.r(t),s.d(t,{Component:()=>k});var i=s(4848),a=s(4022),n=s(6385),r=s(4811),l=s(7665),o=s(2454),u=s(5419),d=s(6287),c=s(6380),h=s(1215),m=s(3133),p=s(400),y=s(4840),x=s(8361),A=s(8032),b=s(8424),j=s(6615),g=s(8448),f=s(4353),v=s.n(f),I=s(6540),w=s(7762);let{Title:C}=d.A,k=()=>{let e=(0,l.jE)(),[t,s]=(0,I.useState)(""),[d,f]=(0,I.useState)(""),[k,M]=(0,I.useState)(!1),[O,S]=(0,I.useState)(null),[N]=c.A.useForm();(0,I.useEffect)(()=>{let e=setTimeout(()=>f(t),300);return()=>clearTimeout(e)},[t]);let{data:R,isLoading:U}=(0,o.I)({queryKey:["adminApps",d],queryFn:()=>w.i.searchApps(d||void 0)}),K=(0,u.n)({mutationFn:e=>{let{id:t,data:s}=e;return w.i.updateApp(t,s)},onSuccess:()=>{h.Ay.success("应用信息已更新"),M(!1),e.invalidateQueries({queryKey:["adminApps"]})},onError:e=>{h.Ay.error(e.message)}}),E=async()=>{try{let e=await N.validateFields();if(!O)return;let t={name:e.name,platform:e.platform,userId:e.userId||null,downloadUrl:e.downloadUrl||null,status:e.status||null,ignoreBuildTime:e.ignoreBuildTime||null};K.mutate({id:O.id,data:t})}catch(e){h.Ay.error(e.message)}},T=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"名称",dataIndex:"name",key:"name",width:150},{title:"App Key",dataIndex:"appKey",key:"appKey",width:200,render:e=>(0,i.jsxs)(m.A,{children:[(0,i.jsx)("span",{className:"font-mono text-xs",children:e}),(0,i.jsx)(p.Ay,{type:"text",size:"small",icon:(0,i.jsx)(a.A,{}),onClick:()=>{navigator.clipboard.writeText(e),h.Ay.success("已复制")}})]})},{title:"平台",dataIndex:"platform",key:"platform",width:80,render:e=>(0,i.jsx)("span",{className:"ios"===e?"text-blue-600":"android"===e?"text-green-600":"text-orange-600",children:e})},{title:"用户ID",dataIndex:"userId",key:"userId",width:80},{title:"状态",dataIndex:"status",key:"status",width:80,render:e=>e||"-"},{title:"忽略构建时间",dataIndex:"ignoreBuildTime",key:"ignoreBuildTime",width:120,render:e=>(0,i.jsx)("span",{className:"enabled"===e?"text-green-600":"",children:"enabled"===e?"是":"disabled"===e?"否":"-"})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>e?v()(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"操作",key:"action",width:80,render:(e,t)=>(0,i.jsx)(p.Ay,{type:"link",icon:(0,i.jsx)(n.A,{}),onClick:()=>{S(t),N.setFieldsValue({name:t.name,platform:t.platform,userId:t.userId,downloadUrl:t.downloadUrl||"",status:t.status||"",ignoreBuildTime:t.ignoreBuildTime}),M(!0)},children:"编辑"})}];return(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)(y.A,{children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(C,{level:4,className:"m-0!",children:"应用管理"}),(0,i.jsx)(x.A,{placeholder:"搜索应用名称或 App Key",prefix:(0,i.jsx)(r.A,{}),value:t,onChange:e=>s(e.target.value),style:{width:300},allowClear:!0})]}),(0,i.jsx)(A.A,{spinning:U,children:(0,i.jsx)(b.A,{dataSource:(null==R?void 0:R.data)||[],columns:T,rowKey:"id",pagination:{pageSize:20},scroll:{x:1e3}})})]}),(0,i.jsx)(j.A,{title:`编辑应用: ${null==O?void 0:O.name}`,open:k,onCancel:()=>M(!1),footer:[(0,i.jsx)(p.Ay,{onClick:()=>M(!1),children:"取消"},"cancel"),(0,i.jsx)(p.Ay,{type:"primary",loading:K.isPending,onClick:E,children:"保存"},"save")],width:600,children:(0,i.jsx)(c.A,{form:N,layout:"vertical",className:"mt-4",children:(0,i.jsxs)(m.A,{className:"w-full",direction:"vertical",size:"middle",children:[(0,i.jsx)(c.A.Item,{name:"name",label:"名称",className:"mb-0!",rules:[{required:!0}],children:(0,i.jsx)(x.A,{})}),(0,i.jsx)(c.A.Item,{name:"platform",label:"平台",className:"mb-0!",children:(0,i.jsx)(g.A,{options:[{value:"ios",label:"iOS"},{value:"android",label:"Android"},{value:"harmony",label:"HarmonyOS"}]})}),(0,i.jsx)(c.A.Item,{name:"userId",label:"用户ID",className:"mb-0!",children:(0,i.jsx)(x.A,{type:"number",placeholder:"留空表示无归属"})}),(0,i.jsx)(c.A.Item,{name:"downloadUrl",label:"下载链接",className:"mb-0!",children:(0,i.jsx)(x.A,{placeholder:"应用商店链接"})}),(0,i.jsx)(c.A.Item,{name:"status",label:"状态",className:"mb-0!",children:(0,i.jsx)(x.A,{placeholder:"自定义状态"})}),(0,i.jsx)(c.A.Item,{name:"ignoreBuildTime",label:"忽略构建时间",className:"mb-0!",children:(0,i.jsx)(g.A,{allowClear:!0,options:[{value:"enabled",label:"启用"},{value:"disabled",label:"禁用"}]})})]})})})]})}},7762(e,t,s){s.d(t,{i:()=>a});var i=s(6126);let a={getConfig:()=>(0,i.Ay)("get","/admin/config"),setConfig:(e,t)=>(0,i.Ay)("post","/admin/config",{key:e,value:t}),deleteConfig:e=>(0,i.Ay)("delete",`/admin/config/${e}`),searchUsers:e=>(0,i.Ay)("get",e?`/admin/users?search=${encodeURIComponent(e)}`:"/admin/users"),updateUser:(e,t)=>(0,i.Ay)("put",`/admin/users/${e}`,t),searchApps:e=>(0,i.Ay)("get",e?`/admin/apps?search=${encodeURIComponent(e)}`:"/admin/apps"),searchVersions:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.appId)&&t.set("appId",String(e.appId));let s=t.toString();return(0,i.Ay)("get",s?`/admin/versions?${s}`:"/admin/versions")},updateVersion:(e,t)=>(0,i.Ay)("put",`/admin/versions/${e}`,t),updateApp:(e,t)=>(0,i.Ay)("put",`/admin/apps/${e}`,t)}},5419(e,t,s){s.d(t,{n:()=>d});var i=s(6540),a=s(6158),n=s(6261),r=s(6500),l=s(4880),o=class extends r.Q{#e;#t=void 0;#s;#i;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,l.f8)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,l.EN)(t.mutationKey)!==(0,l.EN)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#a(),this.#n(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#n()}mutate(e,t){return this.#i=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#a(){let e=this.#s?.state??(0,a.$)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#n(e){n.jG.batch(()=>{if(this.#i&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#i.onSuccess?.(e.data,t,s,i)}catch(e){Promise.reject(e)}try{this.#i.onSettled?.(e.data,null,t,s,i)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#i.onError?.(e.error,t,s,i)}catch(e){Promise.reject(e)}try{this.#i.onSettled?.(void 0,e.error,t,s,i)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#t)})})}},u=s(7665);function d(e,t){let s=(0,u.jE)(t),[a]=i.useState(()=>new o(s,e));i.useEffect(()=>{a.setOptions(e)},[a,e]);let r=i.useSyncExternalStore(i.useCallback(e=>a.subscribe(n.jG.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=i.useCallback((e,t)=>{a.mutate(e,t).catch(l.lQ)},[a]);if(r.error&&(0,l.GU)(a.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:d,mutateAsync:r.mutate}}}}]);