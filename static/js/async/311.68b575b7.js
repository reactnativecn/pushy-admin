"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["311"],{5457(e,l,s){s.r(l),s.d(l,{Component:()=>eA,Manage:()=>ev});var a=s(4848),n=s(3216),t=s(6043),i=s(4901),r=s(2387),d=s(6380),c=s(7152),o=s(6370),m=s(9643),x=s(6845),h=s(3133),u=s(400),p=s(1215),j=s(1344),g=s(6540),y=s(8496),f=s(391),v=s(1568),A=s(6385),k=s(6029),N=s(5292),b=s(8361),w=s(8448),C=s(6287);let I={appId:0,deepLink:"",setDeepLink:()=>{},packages:[],unusedPackages:[],bindings:[],packageMap:new Map},$=(0,g.createContext)(I),S=()=>(0,g.useContext)($),V=e=>{let{children:l,appId:s}=e,[n,t]=(0,g.useState)(window.localStorage.getItem(`${s}_deeplink`)??""),{packages:i,unusedPackages:r,isLoading:d,packageMap:c}=(0,v.xi)(s),{bindings:o,isLoading:m}=(0,v.$R)(s);return(0,a.jsx)($.Provider,{value:{appId:s,deepLink:n,setDeepLink:t,packages:i,packageMap:c,unusedPackages:r,packagesLoading:d,bindings:o,bindingsLoading:m},children:l})};var T=s(285),D=s(8073),F=s(4353),O=s.n(F),R=s(3605),P=s.n(R);let M=e=>{let{commit:l}=e;if(!l)return(0,a.jsx)(D.A,{className:"ant-typography-edit",content:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"text-center my-1 mx-auto",children:[(0,a.jsx)("div",{className:"font-bold",children:"最近的提交："}),(0,a.jsx)("div",{className:"text-gray-500",children:"需要使用 cli v1.42.0+ 版本上传，且使用 git 管理代码才能查看提交记录"})]})}),children:(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(T.A,{}),onClick:()=>{}})});let{origin:s,hash:n,message:t,author:i}=l,r="";if(s)try{let{owner:e,name:l,source:a}=P()(s);r=`https://${a}/${e}/${l}/commit/${n}`}catch(e){console.error(e)}let d=O()(1e3*l.timestamp);return(0,a.jsx)(D.A,{className:"ant-typography-edit",content:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"my-1 mx-auto",children:[(0,a.jsx)("div",{className:"font-bold",children:"最近的提交："}),(0,a.jsxs)("div",{children:["作者：",i]}),(0,a.jsxs)("div",{children:["时间：",d.fromNow(),"（",d.format("YYYY-MM-DD HH:mm:ss"),"）"]}),(0,a.jsxs)("div",{children:["摘要：",t]}),(0,a.jsx)("hr",{}),r?(0,a.jsx)("a",{className:"text-xs",href:r,target:"_blank",rel:"noreferrer",children:n}):(0,a.jsx)("span",{className:"text-xs",children:n})]})}),children:(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(T.A,{}),onClick:()=>{}})})};var _=s(8459),B=s(2986),E=s(6511),W=s(271),L=s(4565),K=s(8231);s(9823);let z=new L.A({detectCircular:!0,maxDepth:1/0,showModifications:!0,arrayDiffMethod:"lcs"}),H=e=>{let{oldDeps:l,newDeps:s}=e;if(!l||!s)return null;let n=z.diff(l,s);return(0,a.jsx)(K.A,{diff:n,highlightInlineDiff:!0})};function Y(e){let{className:l,...s}=e,n=(0,g.useRef)(null),t=(0,g.useRef)(null);return(0,g.useEffect)(()=>(t.current=(0,W._j)({target:n.current,props:{mode:W.Kt.text,...s}}),()=>{t.current&&t.current.destroy()}),[]),(0,g.useEffect)(()=>{var e;null==(e=t.current)||e.updateProps(s)},[s]),(0,a.jsx)("div",{className:l,ref:n})}let J=e=>{let{deps:l,name:s}=e,{packages:n,appId:t}=S(),{allVersions:i}=(0,v.jh)({appId:t}),[r,d]=(0,g.useState)(null);return(0,a.jsx)(D.A,{className:"ant-typography-edit",afterOpenChange:e=>{e||d(null)},content:(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"text-center my-1 mx-auto",children:l?(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsxs)("div",{className:"h-12",children:[(0,a.jsxs)("div",{className:"font-bold",children:["JavaScript 依赖列表",!r&&`(${s})`,(0,a.jsx)("div",{children:r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-normal",children:r.newName}),` <-> ${s}`]})})]}),(0,a.jsx)("div",{className:"absolute right-3 top-3",children:r?(0,a.jsx)(u.Ay,{className:"content-end",onClick:()=>{d(null)},children:"返回"}):(0,a.jsx)(E.A,{menu:{items:[{key:"package",type:"group",label:"原生包",children:n.filter(e=>!!e.deps).map(e=>({key:`p_${e.id}`,label:e.name}))},{key:"version",type:"group",label:"热更包",children:i.filter(e=>!!e.deps).map(e=>({key:`v_${e.id}`,label:e.name}))}],onClick:e=>{let{key:s}=e,[a,t]=s.split("_");if("p"===a){let e=n.find(e=>e.id===+t);d({oldDeps:null==e?void 0:e.deps,newDeps:l,newName:`原生包 ${null==e?void 0:e.name}`})}else{let e=i.find(e=>e.id===+t);d({oldDeps:null==e?void 0:e.deps,newDeps:l,newName:`热更包 ${null==e?void 0:e.name}`})}}},children:(0,a.jsxs)(u.Ay,{children:["对比变更",(0,a.jsx)(_.A,{})]})})})]}),(0,a.jsx)("div",{className:"max-h-[50vh] overflow-y-auto",children:r?(0,a.jsx)(H,{oldDeps:r.oldDeps,newDeps:r.newDeps}):(0,a.jsx)(Y,{content:{json:Object.keys(l).sort().reduce((e,s)=>(e[s]=l[s],e),{})},mode:W.Kt.tree,mainMenuBar:!1,statusBar:!1,readOnly:!0})}),(0,a.jsxs)("div",{className:"text-gray-500 my-4",children:["仅在",(0,a.jsx)("span",{className:"font-bold underline",children:"上传"}),"时抓取package.json的直接依赖， 不保证严格匹配包内容，仅供参考。"]})]})}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{children:"JavaScript 依赖列表"}),(0,a.jsx)("div",{className:"text-gray-500",children:"需要使用 cli v1.42.0+ 版本上传才能查看依赖列表"})]})})}),children:(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(B.A,{}),onClick:()=>{}})})},U=e=>{let{dataSource:l,loading:s}=e;return(0,a.jsx)(N.A,{loading:s,className:"packages",size:"small",dataSource:l,renderItem:e=>(0,a.jsx)(Q,{item:e})})},Q=e=>{let{item:l}=e,{appId:s}=S();return(0,a.jsx)("div",{className:"bg-white my-0 [&_li]:px-0!",children:(0,a.jsx)(N.A.Item,{className:"p-2",children:(0,a.jsx)(N.A.Item.Meta,{title:(0,a.jsxs)(c.A,{align:"middle",children:[(0,a.jsxs)(o.A,{flex:1,children:[l.name,l.status&&"normal"!==l.status&&(0,a.jsx)(x.A,{className:"ml-2",children:q[l.status]})]}),(0,a.jsx)(J,{deps:l.deps,name:`原生包 ${l.name}`}),(0,a.jsx)(M,{commit:l.commit}),(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(A.A,{}),onClick:()=>(function(e,l){let{note:s,status:n}=e;r.A.confirm({icon:null,closable:!0,maskClosable:!0,content:(0,a.jsxs)(d.A,{layout:"vertical",initialValues:e,children:[(0,a.jsx)(d.A.Item,{name:"note",label:"备注",children:(0,a.jsx)(b.A,{placeholder:"添加原生包备注",onChange:e=>{let{target:l}=e;return s=l.value}})}),(0,a.jsx)(d.A.Item,{name:"status",label:"状态",children:(0,a.jsxs)(w.A,{onSelect:e=>{n=e},children:[(0,a.jsx)(w.A.Option,{value:"normal",children:"正常"}),(0,a.jsx)(w.A.Option,{value:"paused",children:"暂停"}),(0,a.jsx)(w.A.Option,{value:"expired",children:"过期"})]})})]}),async onOk(){await f.F.updatePackage({appId:l,packageId:e.id,params:{note:s,status:n}})}})})(l,s)}),(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(k.A,{}),onClick:()=>{r.A.confirm({title:`删除后无法恢复，确定删除原生包“${l.name}”？`,maskClosable:!0,okButtonProps:{danger:!0},async onOk(){await f.F.deletePackage({appId:s,packageId:l.id})}})},danger:!0})]}),description:(0,a.jsxs)("div",{children:[l.note&&(0,a.jsxs)(C.A.Paragraph,{className:"mb-0",type:"secondary",ellipsis:{tooltip:l.note},children:["备注：",l.note]}),(0,a.jsx)("div",{className:"text-xs flex flex-col gap-1",children:(0,a.jsxs)("div",{children:["编译时间：",l.buildTime]})})]})})})})},q={paused:"暂停",expired:"过期"};var G=s(6327),X=s(6416),Z=s(1252);let ee=()=>{let{user:e}=(0,v.Py)(),{appId:l}=S(),s=d.A.useWatch("appKey"),n=d.A.useWatch("ignoreBuildTime");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A.Item,{label:"AppId",layout:"vertical",children:(0,a.jsx)(C.A.Paragraph,{className:"!mb-0",type:"secondary",copyable:!0,children:l})}),(0,a.jsx)(d.A.Item,{label:"AppKey",name:"appKey",layout:"vertical",children:(0,a.jsx)(C.A.Paragraph,{className:"!mb-0",type:"secondary",copyable:!0,children:s})}),(0,a.jsx)(d.A.Item,{label:"应用名",name:"name",layout:"vertical",children:(0,a.jsx)(b.A,{})}),(0,a.jsx)(d.A.Item,{label:"原生包下载地址（当用户端的原生版本过期时，会使用此地址下载）",name:"downloadUrl",layout:"vertical",children:(0,a.jsx)(b.A,{})}),(0,a.jsx)(d.A.Item,{layout:"vertical",label:"启用热更新",name:"status",normalize:e=>e?"normal":"paused",getValueProps:e=>({value:"normal"===e||null==e}),children:(0,a.jsx)(X.A,{checkedChildren:"已启用",unCheckedChildren:"已暂停"})}),(0,a.jsx)(d.A.Item,{layout:"vertical",label:"忽略编译时间戳（高级版以上可启用）",name:"ignoreBuildTime",normalize:e=>e?"enabled":"disabled",getValueProps:e=>({value:"enabled"===e}),children:(0,a.jsx)(X.A,{disabled:((null==e?void 0:e.tier)==="free"||(null==e?void 0:e.tier)==="standard")&&"enabled"!==n,checkedChildren:"已启用",unCheckedChildren:"已禁用"})}),(0,a.jsx)(d.A.Item,{label:"删除应用",layout:"vertical",children:(0,a.jsx)(u.Ay,{type:"primary",icon:(0,a.jsx)(G.A,{}),onClick:()=>{r.A.confirm({title:"应用删除后无法恢复",okText:"确认删除",okButtonProps:{danger:!0},async onOk(){await f.F.deleteApp(l),r.A.destroyAll(),Z.QB.navigate(Z.DQ.apps)}})},danger:!0,children:"删除"})})]})};var el=s(928),es=s(8866),ea=s(8826),en=s(518),et=s(6992),ei=s(3797),er=s(2481),ed=s(7904),ec=s(7011),eo=s(1455),em=s(4413),ex=s(1559);let eh=e=>{let{packageName:l,versionDisplayName:s,changes:n}=e,[t,i]=(0,g.useState)({新增:!0,移除:!0,版本变更:!0}),r=(0,g.useMemo)(()=>n.reduce((e,l)=>("新增"===l.changeType?e.added+=1:"移除"===l.changeType?e.removed+=1:e.changed+=1,e),{added:0,removed:0,changed:0}),[n]),d=(0,g.useMemo)(()=>n.filter(e=>t[e.changeType]),[n,t]),c=(0,g.useMemo)(()=>(function(e){let{summary:l,filters:s,onFilterChange:n}=e;return[{title:(0,a.jsxs)("span",{children:["依赖（",(0,a.jsx)(en.A,{checked:s.新增,onChange:e=>{let{target:l}=e;n("新增",l.checked)}}),(0,a.jsxs)("span",{className:"ml-1",style:{color:"#dc2626",fontWeight:700},children:["新增 ",l.added]}),"，",(0,a.jsx)(en.A,{checked:s.移除,onChange:e=>{let{target:l}=e;n("移除",l.checked)}}),(0,a.jsxs)("span",{className:"ml-1",style:{color:"#16a34a",fontWeight:700},children:["移除 ",l.removed]}),"，",(0,a.jsx)(en.A,{checked:s.版本变更,onChange:e=>{let{target:l}=e;n("版本变更",l.checked)}}),(0,a.jsxs)("span",{className:"ml-1",style:{color:"#d97706",fontWeight:700},children:["变更 ",l.changed]}),"）"]}),dataIndex:"dependency",key:"dependency",ellipsis:!0},{title:"版本变化",key:"versionChange",ellipsis:!0,render:(e,l)=>"版本变更"===l.changeType?(0,a.jsxs)("span",{className:"font-mono",children:[(0,a.jsx)("span",{style:{color:"#d97706",fontWeight:600},children:l.oldVersion}),(0,a.jsx)(er.A,{className:"mx-2 text-gray-400"}),(0,a.jsx)("span",{style:{color:"#d97706",fontWeight:600},children:l.newVersion})]}):"新增"===l.changeType?(0,a.jsxs)("span",{className:"font-mono",children:[(0,a.jsx)("span",{style:{color:"#dc2626",fontWeight:700},children:"新增"}),(0,a.jsx)("span",{className:"mx-2 text-gray-400",children:"|"}),(0,a.jsx)("span",{style:{color:"#6b7280"},children:l.oldVersion}),(0,a.jsx)(er.A,{className:"mx-2 text-gray-400"}),(0,a.jsx)("span",{style:{color:"#dc2626",fontWeight:600},children:l.newVersion})]}):(0,a.jsxs)("span",{className:"font-mono",children:[(0,a.jsx)("span",{style:{color:"#16a34a",fontWeight:700},children:"移除"}),(0,a.jsx)("span",{className:"mx-2 text-gray-400",children:"|"}),(0,a.jsx)("span",{style:{color:"#16a34a",fontWeight:600},children:l.oldVersion}),(0,a.jsx)(er.A,{className:"mx-2 text-gray-400"}),(0,a.jsx)("span",{style:{color:"#6b7280"},children:l.newVersion})]})}]})({summary:r,filters:t,onFilterChange:(e,l)=>{i(s=>({...s,[e]:l}))}}),[r,t]);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:["目标原生包：",l]}),(0,a.jsxs)("div",{children:["热更包：",s]}),(0,a.jsx)(ex.A,{className:"mt-3",showIcon:!0,type:"warning",message:(0,a.jsxs)("span",{children:["如果变更的依赖是纯 JS 模块，则一般没有影响；若包含",(0,a.jsx)("strong",{children:"原生代码"}),"的新增或变化，热更可能导致功能不正常甚至闪退。建议仔细检查并在正式发布前使用扫码功能完整测试。"]})}),(0,a.jsx)(et.A,{className:"mt-3",size:"small",pagination:!1,columns:c,dataSource:d,scroll:{y:320},locale:{emptyText:"当前筛选条件下无依赖变化"}})]})},eu=e=>{let{versionId:l,config:s,versionDeps:n,versionName:t}=e,{packages:i,appId:d,bindings:c,packageMap:o}=S(),m=(e,s)=>{let i=()=>f.F.upsertBinding({appId:d,packageId:e.id,versionId:l,rollout:s}),c=function(e,l){if(!e||!l)return null;let s=[];for(let a of Object.keys({...e,...l}).sort((e,l)=>e.localeCompare(l))){let n=e[a],t=l[a];if(void 0===n&&void 0!==t){s.push({key:a,dependency:a,oldVersion:"-",newVersion:t,changeType:"新增"});continue}if(void 0!==n&&void 0===t){s.push({key:a,dependency:a,oldVersion:n,newVersion:"-",changeType:"移除"});continue}n!==t&&void 0!==n&&void 0!==t&&s.push({key:a,dependency:a,oldVersion:n,newVersion:t,changeType:"版本变更"})}return s}(e.deps,n);c&&0!==c.length?r.A.confirm({title:"检测到依赖变化，确认继续发布？",maskClosable:!0,okButtonProps:{danger:!0},okText:"继续发布",cancelText:"取消",width:820,content:(0,a.jsx)(eh,{packageName:e.name,versionDisplayName:t||l,changes:c}),async onOk(){await i()}}):i()},x=(()=>{let e=[],n=[];for(let e of i){var t,r;if((null==(t=e.versions)?void 0:t.id)===l){let l=null==s||null==(r=s.rollout)?void 0:r[e.name];n.push({packageId:e.id,rollout:l})}}let x=n.concat(c.filter(e=>e.versionId===l));if(0===x.length||0===i.length)return null;for(let l of x){let s=o.get(l.packageId);if(!s)continue;let n=l.rollout,t=100===n||null==n,i=Number(n),r=t?[]:[{key:"full",label:"全量",icon:(0,a.jsx)(ed.A,{}),onClick:()=>m(s)}];i<50&&!t&&r.push({key:"gray",label:"灰度",icon:(0,a.jsx)(ec.A,{}),children:[1,2,5,10,20,50].filter(e=>e>i).map(e=>({key:`${e}`,label:`${e}%`,onClick:()=>m(s,e)}))}),r.length>0&&r.push({type:"divider"}),r.push({key:"unpublish",label:"取消发布",icon:(0,a.jsx)(eo.A,{}),onClick:()=>{let e=l.id;e?f.F.deleteBinding({appId:d,bindingId:e}):f.F.updatePackage({appId:d,packageId:s.id,params:{versionId:null}})}});let c=(0,a.jsxs)(u.Ay,{size:"small",color:"primary",variant:t?"filled":"dashed",children:[(0,a.jsx)("span",{className:"font-bold",children:s.name}),(0,a.jsx)("span",{className:"text-xs",children:t?"":`(${n}%)`})]});e.push((0,a.jsx)(E.A,{menu:{items:r},children:c},s.id))}return e})();return(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[x,0!==i.length&&(0,a.jsx)(E.A,{menu:{items:i.map(e=>({key:`pkg-${e.id}`,label:e.name,children:[{key:`pkg-${e.id}-full`,label:"全量",icon:(0,a.jsx)(ed.A,{}),onClick:()=>m(e)},{key:`pkg-${e.id}-gray`,label:"灰度",icon:(0,a.jsx)(ec.A,{}),children:[1,2,5,10,20,50].map(l=>({key:`pkg-${e.id}-gray-${l}`,label:`${l}%`,onClick:()=>m(e,l)}))}]}))},className:"ant-typography-edit",children:(0,a.jsx)(u.Ay,{type:"link",size:"small",icon:(0,a.jsx)(em.A,{}),children:"发布"})})]})},ep=e=>{let{name:l,hash:s}=e,{appId:n,deepLink:t,setDeepLink:i}=S(),[r,d]=(0,g.useState)(!!t),c=r&&t.endsWith("://");(0,g.useEffect)(()=>{c&&window.localStorage.setItem(`${n}_deeplink`,t)},[n,t,c]);let o={type:"__rnPushyVersionHash",data:s},m=c?`${t}?${new URLSearchParams(o).toString()}`:JSON.stringify(o);return(0,a.jsx)(D.A,{className:"ant-typography-edit",content:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-center my-2 mx-auto",children:["测试二维码 ",(0,a.jsx)("br",{}),(0,a.jsx)("a",{target:"_blank",className:"ml-1 text-xs",href:ei.c,rel:"noreferrer",children:"如何使用？"})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(ea.A,{value:m,bordered:!1})}),(0,a.jsx)("div",{className:"text-center my-2 mx-auto",children:l}),(0,a.jsxs)("div",{children:[(0,a.jsx)(b.A.TextArea,{readOnly:!0,autoSize:!0,value:m,className:"mb-2!"}),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)(en.A,{className:"mr-4",checked:r,onChange:e=>{let{target:l}=e;d(l.checked)},children:"使用 Deep Link："}),(0,a.jsx)(b.A,{placeholder:"例如 pushy://",className:"flex-1",value:t,onChange:e=>{let{target:l}=e;i(l.value)}})]})]})]}),children:(0,a.jsx)(u.Ay,{type:"link",icon:(0,a.jsx)(el.A,{}),onClick:()=>{}})})},ej=[{title:"版本",dataIndex:"name",render:(e,l)=>(0,a.jsx)(eg,{record:l,recordKey:"name",extra:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J,{deps:l.deps,name:`热更包 ${l.name}`}),(0,a.jsx)(M,{commit:l.commit}),(0,a.jsx)(ep,{name:l.name,hash:l.hash})]})})},{title:"描述",dataIndex:"description",render:(e,l)=>(0,a.jsx)(eg,{record:l,recordKey:"description"})},{title:"自定义元信息",dataIndex:"metaInfo",render:(e,l)=>(0,a.jsx)(eg,{record:l,recordKey:"metaInfo"})},{title:(0,a.jsxs)(D.A,{content:(0,a.jsx)(function(){return(0,a.jsxs)("div",{className:"w-[600px]",children:[(0,a.jsx)(et.A,{size:"small",pagination:!1,dataSource:[{key:"1",version:"< v10.15.0",fullRelease:"✓ 支持",grayRelease:"✗ 不支持",bothRelease:"⚠ 灰度被忽略"},{key:"2",version:"v10.15.0 - v10.31.3",fullRelease:"✓ 支持",grayRelease:"✓ 支持",bothRelease:"⚠ 灰度被忽略"},{key:"3",version:"≥ v10.32.0",fullRelease:"✓ 支持",grayRelease:"✓ 支持",bothRelease:"✓ 支持（cli >= 2.4.0）"}],columns:[{title:(0,a.jsxs)("span",{children:["react-native-update 版本",(0,a.jsx)("br",{}),"(用户端)"]}),dataIndex:"version",key:"version",width:200},{title:"仅全量发布",dataIndex:"fullRelease",key:"fullRelease",align:"center",render:e=>(0,a.jsx)(x.A,{color:e.includes("✓")?"success":"error",children:e})},{title:"仅灰度发布",dataIndex:"grayRelease",key:"grayRelease",align:"center",render:e=>(0,a.jsx)(x.A,{color:e.includes("✓")?"success":"error",children:e})},{title:"同时发布",dataIndex:"bothRelease",key:"bothRelease",align:"center",render:e=>{let l=e.includes("✓")?"success":e.includes("⚠")?"warning":"error";return(0,a.jsx)(x.A,{color:l,children:e})}}]}),(0,a.jsx)("div",{className:"mt-2",children:"注：取消发布不会导致已更新的用户回滚。"})]})},{}),children:["发布到原生包",(0,a.jsxs)("span",{className:"text-amber-600",children:["(",(0,a.jsx)(es.A,{}),"功能说明)"]})]}),dataIndex:"packages",width:"100%",render:(e,l)=>{let{id:s,config:n,deps:t,name:i}=l;return(0,a.jsx)(eu,{config:n,versionId:s,versionDeps:t,versionName:i})}},{title:"上传时间",dataIndex:"createdAt",render:(e,l)=>(0,a.jsx)(eg,{record:l,recordKey:"createdAt",isEditable:!1})}],eg=e=>{let{record:l,recordKey:s,isEditable:n=!0,extra:t}=e,{appId:i}=S(),d=l[s];if("createdAt"===s){let e=new Date(d),l=e.getFullYear(),s=e.getMonth()+1,a=s<10?`0${s}`:s,n=10>e.getDate()?`0${e.getDate()}`:e.getDate(),t=10>e.getHours()?`0${e.getHours()}`:e.getHours(),i=10>e.getMinutes()?`0${e.getMinutes()}`:e.getMinutes();d=`${l}-${a}-${n} ${t}:${i}`}let c=null;return n&&(c={editing:!1,onStart(){var e;let n=d;r.A.confirm({icon:null,width:"metaInfo"===s?640:void 0,title:null==(e=ej.find(e=>e.dataIndex===s))?void 0:e.title,closable:!0,maskClosable:!0,content:"metaInfo"===s?(0,a.jsx)(Y,{className:"h-96",content:{text:d??""},onChange:e=>{d=e.text}}):(0,a.jsx)(b.A.TextArea,{defaultValue:d,onChange:e=>{let{target:l}=e;d=l.value}}),async onOk(){n=d,await f.F.updateVersion({appId:i,versionId:l.id,params:{[s]:d}})},async onCancel(){d=n}})}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C.A.Text,{className:"w-40",editable:c,ellipsis:!0,children:d}),t]})};function ey(){let{appId:e}=S(),[l,s]=(0,g.useState)([]),[n,t]=(0,g.useState)(0),[i,d]=(0,g.useState)(10),{versions:c,count:o,isLoading:m}=(0,v.jh)({appId:e,offset:n,limit:i});return(0,a.jsx)(et.A,{className:"versions",rowKey:"id",title:()=>"热更包",columns:ej,dataSource:c,pagination:{showSizeChanger:!0,total:o,current:n/i+1,pageSize:i,showTotal:e=>`共 ${e} 个 `,onChange(e,l){l&&(t((e-1)*l),d(l))}},rowSelection:{selections:[et.A.SELECTION_ALL,et.A.SELECTION_INVERT,et.A.SELECTION_NONE],onChange:e=>s(e)},loading:m,footer:l.length?()=>(0,a.jsx)(u.Ay,{onClick:()=>(function(e){let{selected:l,versions:s,appId:a}=e,n=[];for(let e of s)l.includes(e.id)&&n.push(e.name);r.A.confirm({title:"删除所选热更包：",content:n.join("，"),maskClosable:!0,okButtonProps:{danger:!0},async onOk(){await Promise.all(l.map(e=>f.F.deleteVersion({appId:a,versionId:e})))}})})({selected:l,versions:c,appId:e}),danger:!0,children:"删除"}):void 0})}let ef=()=>{let{packages:e,unusedPackages:l,packagesLoading:s}=S();return(0,a.jsxs)(t.A,{className:"manage-layout",children:[(0,a.jsxs)(t.A.Sider,{theme:"light",className:"manage-sider p-4 pt-0 mr-4 h-full rounded-lg",width:240,children:[(0,a.jsx)("div",{className:"py-4",children:"原生包"}),(0,a.jsx)(i.A,{items:[{key:"all",label:"全部",children:(0,a.jsx)(U,{dataSource:e,loading:s})},{key:"unused",label:"未使用",children:(0,a.jsx)(U,{dataSource:l,loading:s})}]})]}),(0,a.jsx)(t.A.Content,{className:"p-0! manage-content",children:(0,a.jsx)(ey,{})})]})},ev=()=>{let[e,l]=r.A.useModal(),s=Number((0,j.g)().id),{app:t}=(0,v.nm)(s),[i]=d.A.useForm();return(0,g.useEffect)(()=>{t&&i.setFieldsValue(t)},[t,i]),(0,a.jsxs)(d.A,{layout:"vertical",form:i,initialValues:t,children:[(0,a.jsxs)(c.A,{className:"mb-4 flex-col gap-3 md:flex-row md:items-center",children:[(0,a.jsx)(o.A,{flex:1,className:"min-w-0",children:(0,a.jsx)(m.A,{items:[{title:(0,a.jsx)(j.N_,{to:"/apps",children:"应用列表"})},{title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{platform:null==t?void 0:t.platform,className:"mr-1"}),null==t?void 0:t.name,(null==t?void 0:t.status)==="paused"&&(0,a.jsx)(x.A,{className:"ml-2",children:"暂停"})]})}]})}),(0,a.jsx)(h.A.Compact,{className:"w-full md:w-auto",children:(0,a.jsx)(u.Ay,{type:"primary",icon:(0,a.jsx)(n.A,{}),className:"w-full md:w-auto",onClick:()=>{e.confirm({icon:null,closable:!0,maskClosable:!0,content:(0,a.jsx)(ee,{}),async onOk(){try{await f.F.updateApp(s,{name:i.getFieldValue("name"),downloadUrl:i.getFieldValue("downloadUrl"),status:i.getFieldValue("status"),ignoreBuildTime:i.getFieldValue("ignoreBuildTime")})}catch(e){p.Ay.error(e.message);return}p.Ay.success("修改成功")}})},children:"应用设置"})})]}),(0,a.jsxs)(V,{appId:s,children:[l,(0,a.jsx)(ef,{})]})]})},eA=ev}}]);