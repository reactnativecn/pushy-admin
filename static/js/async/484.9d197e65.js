"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["484"],{5335(e,t,r){r.r(t),r.d(t,{Component:()=>S});var n=r(4848),s=r(6029),l=r(8623),a=r(156),i=r(7665),c=r(2454),u=r(998),d=r(6380),y=r(1215),o=r(3133),x=r(400),h=r(5021),m=r(4840),j=r(8032),A=r(7130),p=r(6615),f=r(8361),g=r(6540),k=r(271),v=r(391);let{Title:C}=u.A,N=e=>{let{value:t,onChange:r}=e,s=(0,g.useRef)(null),l=(0,g.useRef)(null);return(0,g.useEffect)(()=>(s.current&&!l.current&&(l.current=new k.uL({target:s.current,props:{content:{text:t},onChange:(e,t,n)=>{let{contentErrors:s}=n;!s&&("json"in e&&void 0!==e.json?r(JSON.stringify(e.json,null,2)):"text"in e&&r(e.text))},mode:"text"}})),()=>{l.current&&(l.current.destroy(),l.current=null)}),[]),(0,g.useEffect)(()=>{l.current&&l.current.update({text:t})},[t]),(0,n.jsx)("div",{ref:s,style:{height:300}})},S=()=>{let e=(0,i.jE)(),[t,r]=(0,g.useState)(!1),[u,k]=(0,g.useState)(null),[S]=d.A.useForm(),[w,b]=(0,g.useState)(""),{data:O,isLoading:J,refetch:F}=(0,c.I)({queryKey:["adminConfig"],queryFn:()=>v.F.getAdminConfig()}),I=(null==O?void 0:O.data)?Object.entries(O.data).map(e=>{let[t,r]=e;return{key:t,value:r}}):[],K=async()=>{try{let t,n=(await S.validateFields()).key;try{t=JSON.parse(w)}catch{y.Ay.error("请输入有效的 JSON 格式");return}let s=JSON.stringify(t);await v.F.setAdminConfig(n,s),y.Ay.success("保存成功"),r(!1),e.invalidateQueries({queryKey:["adminConfig"]})}catch(e){y.Ay.error(e.message)}},q=(0,g.useCallback)(async e=>{try{await v.F.deleteAdminConfig(e),y.Ay.success("已删除"),F()}catch(e){y.Ay.error(e.message)}},[F]),E=[{title:"Key",dataIndex:"key",key:"key",width:200},{title:"Value",dataIndex:"value",key:"value",render:e=>{try{let t=JSON.parse(e);return(0,n.jsx)("pre",{className:"m-0 max-h-24 overflow-auto text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(t,null,2)})}catch{return(0,n.jsx)("span",{className:"text-gray-600",children:e})}}},{title:"操作",key:"action",width:150,render:(e,t)=>(0,n.jsxs)(o.A,{children:[(0,n.jsx)(x.Ay,{type:"link",onClick:()=>(e=>{k(e),S.setFieldsValue({key:e.key});try{b(JSON.stringify(JSON.parse(e.value),null,2))}catch{b(e.value)}r(!0)})(t),children:"编辑"}),(0,n.jsx)(h.A,{title:"确定删除此配置？",onConfirm:()=>q(t.key),children:(0,n.jsx)(x.Ay,{type:"link",danger:!0,icon:(0,n.jsx)(s.A,{})})})]})}];return(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)(m.A,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(C,{level:4,className:"m-0!",children:"动态配置管理"}),(0,n.jsx)(x.Ay,{type:"primary",icon:(0,n.jsx)(l.A,{}),onClick:()=>{k(null),S.resetFields(),b(""),r(!0)},children:"添加配置"})]}),(0,n.jsx)(j.A,{spinning:J,children:(0,n.jsx)(A.A,{dataSource:I,columns:E,rowKey:"key",pagination:!1})})]}),(0,n.jsx)(p.A,{title:u?"编辑配置":"添加配置",open:t,onCancel:()=>r(!1),footer:[(0,n.jsx)(x.Ay,{onClick:()=>r(!1),children:"取消"},"cancel"),(0,n.jsx)(x.Ay,{type:"primary",icon:(0,n.jsx)(a.A,{}),onClick:K,children:"保存"},"save")],width:700,children:(0,n.jsxs)(d.A,{form:S,layout:"vertical",children:[(0,n.jsx)(d.A.Item,{name:"key",label:"Key",rules:[{required:!0,message:"请输入配置键名"}],children:(0,n.jsx)(f.A,{disabled:!!u,placeholder:"配置键名"})}),(0,n.jsx)(d.A.Item,{label:"Value (JSON)",children:(0,n.jsx)(N,{value:w,onChange:b})})]})})]})}}}]);