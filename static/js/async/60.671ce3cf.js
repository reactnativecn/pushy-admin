"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["60"],{9647(e,t,l){l.r(t),l.d(t,{Component:()=>L});var a=l(4848),r=l(7833),n=l(2454),s=l(6287),i=l(8150),o=l(4840),c=l(3133),u=l(2685),d=l(8448),m=l(8032),f=l(6540),p=l(8248),g=l(682),v=l(9302),h=l(4164),x=l(5541),y=l(2279),b=l(2441);let $=e=>{let t,{value:l,formatter:a,precision:r,decimalSeparator:n,groupSeparator:s="",prefixCls:i}=e;if("function"==typeof a)t=a(l);else{let e=String(l),a=e.match(/^(-?)(\d*)(\.(\d+))?$/);if(a&&"-"!==e){let e=a[1],l=a[2]||"0",o=a[4]||"";l=l.replace(/\B(?=(\d{3})+(?!\d))/g,s),"number"==typeof r&&(o=o.padEnd(r,"0").slice(0,r>0?r:0)),o&&(o=`${n}${o}`),t=[f.createElement("span",{key:"int",className:`${i}-content-value-int`},e,l),o&&f.createElement("span",{key:"decimal",className:`${i}-content-value-decimal`},o)]}else t=e}return f.createElement("span",{className:`${i}-content-value`},t)};var M=l(5905),j=l(7358),w=l(8986);let S=(0,j.OF)("Statistic",e=>(e=>{let{componentCls:t,marginXXS:l,padding:a,colorTextDescription:r,titleFontSize:n,colorTextHeading:s,contentFontSize:i,fontFamily:o}=e;return{[t]:{...(0,M.dF)(e),[`${t}-header`]:{paddingBottom:l,[`${t}-title`]:{color:r,fontSize:n}},[`${t}-skeleton`]:{paddingTop:a},[`${t}-content`]:{color:s,fontSize:i,fontFamily:o,[`${t}-content-value`]:{display:"inline-block",direction:"ltr"},[`${t}-content-prefix, ${t}-content-suffix`]:{display:"inline-block"},[`${t}-content-prefix`]:{marginInlineEnd:l},[`${t}-content-suffix`]:{marginInlineStart:l}}}}})((0,w.oX)(e,{})),e=>{let{fontSizeHeading3:t,fontSize:l}=e;return{titleFontSize:l,contentFontSize:t}}),N=f.forwardRef((e,t)=>{let{prefixCls:l,className:a,rootClassName:r,style:n,valueStyle:s,value:i=0,title:o,valueRender:c,prefix:u,suffix:d,loading:m=!1,formatter:p,precision:g,decimalSeparator:M=".",groupSeparator:j=",",onMouseEnter:w,onMouseLeave:N,styles:A,classNames:E,...F}=e,{getPrefixCls:k,direction:I,className:C,style:z,classNames:D,styles:O}=(0,y.TP)("statistic"),R=k("statistic",l),[T,H]=S(R),L={...e,decimalSeparator:M,groupSeparator:j,loading:m,value:i},[q,B]=(0,x.AV)([D,E],[O,A],{props:L}),_=f.createElement($,{decimalSeparator:M,groupSeparator:j,prefixCls:R,formatter:p,precision:g,value:i}),G=(0,h.$)(R,{[`${R}-rtl`]:"rtl"===I},C,a,r,q.root,T,H),K=(0,h.$)(`${R}-header`,q.header),P=(0,h.$)(`${R}-title`,q.title),V=(0,h.$)(`${R}-content`,q.content),W=(0,h.$)(`${R}-content-prefix`,q.prefix),X=(0,h.$)(`${R}-content-suffix`,q.suffix),Y=f.useRef(null);f.useImperativeHandle(t,()=>({nativeElement:Y.current}));let J=(0,v.A)(F,{aria:!0,data:!0});return f.createElement("div",{...J,className:G,style:{...B.root,...z,...n},ref:Y,onMouseEnter:w,onMouseLeave:N},o&&f.createElement("div",{className:K,style:B.header},f.createElement("div",{className:P,style:B.title},o)),f.createElement(b.A,{paragraph:!1,loading:m,className:`${R}-skeleton`,active:!0},f.createElement("div",{className:V,style:{...s,...B.content}},u&&f.createElement("span",{className:W,style:B.prefix},u),c?c(_):_,d&&f.createElement("span",{className:X,style:B.suffix},d))))}),A=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]],E=1e3/60,F=e=>{let{value:t,format:l="HH:mm:ss",onChange:a,onFinish:r,type:n,...s}=e,i="countdown"===n,[o,c]=f.useState(null),u=(0,p._q)(()=>{let e=Date.now(),l=new Date(t).getTime();c({});let n=i?l-e:e-l;return a?.(n),!i||!(l<e)||(r?.(),!1)});return f.useEffect(()=>{let e;return e=window.setInterval(()=>{u()||window.clearInterval(e)},E),()=>{window.clearInterval(e)}},[t,i]),f.useEffect(()=>{c({})},[]),f.createElement(N,{...s,value:t,valueRender:e=>(0,g.Ob)(e,{title:void 0}),formatter:(e,t)=>o?function(e,t,l){let a,r,n,s,i,o,{format:c=""}=t,u=new Date(e).getTime(),d=Date.now();return a=l?Math.max(u-d,0):Math.max(d-u,0),r=/\[[^\]]*]/g,n=(c.match(r)||[]).map(e=>e.slice(1,-1)),s=c.replace(r,"[]"),i=A.reduce((e,[t,l])=>{if(e.includes(t)){let r=Math.floor(a/l);return a-=r*l,e.replace(RegExp(`${t}+`,"g"),e=>{let t=e.length;return r.toString().padStart(t,"0")})}return e},s),o=0,i.replace(r,()=>{let e=n[o];return o+=1,e})}(e,{...t,format:l},i):"-"})},k=f.memo(e=>f.createElement(F,{...e,type:"countdown"}));N.Timer=F,N.Countdown=k;var I=l(4353),C=l.n(I),z=l(391);let{Title:D}=s.A,{RangePicker:O}=i.A,R="total",T={pv:"请求数",uv:"用户数"},H=[{label:"rn",value:"rn"},{label:"os",value:"os"},{label:"rnu",value:"rnu"}],L=()=>{let[e,t]=(0,f.useState)([C()().subtract(24,"hour"),C()()]),[l,s]=(0,f.useState)("pv"),[i,p]=(0,f.useState)("rn"),g=(0,f.useRef)([]),v=e[0].toISOString(),h=e[1].toISOString(),{data:x,isLoading:y}=(0,n.I)({queryKey:["globalMetrics",v,h,"pv"],queryFn:()=>z.F.getGlobalMetrics({start:v,end:h,mode:"pv"}),enabled:!!e[0]&&!!e[1]}),{data:b,isLoading:$}=(0,n.I)({queryKey:["globalMetrics",v,h,"uv"],queryFn:()=>z.F.getGlobalMetrics({start:v,end:h,mode:"uv"}),enabled:!!e[0]&&!!e[1]}),M="pv"===l?x:b,j=(0,f.useMemo)(()=>{if(!(null==M?void 0:M.data)||!(null==M?void 0:M.dict))return[];let e=[];for(let t of M.data)for(let[l,a]of t.data){let r=M.dict[l]||"";if("_total"===r)continue;let n=r.replace("\x1f",": ");r.endsWith("\x1f")&&(n=r.replace("\x1f",": unknown")),e.push({time:t.time,value:a,category:n})}return e},[M]),w=(0,f.useMemo)(()=>j.length?j.filter(e=>{var t;let l;return(-1===(l=(t=e.category).indexOf(":"))?t.trim():t.slice(0,l).trim())===i}):[],[j,i]),S=(0,f.useMemo)(()=>{let e=new Map;for(let t of w)e.set(t.category,(e.get(t.category)||0)+t.value);return e},[w]),A=(0,f.useMemo)(()=>Array.from(S.entries()).sort((e,t)=>t[1]-e[1]).map(e=>{let[t]=e;return t}),[S]),E=(0,f.useMemo)(()=>{if(!w.length)return[];let e=new Map;for(let t of w)e.set(t.time,(e.get(t.time)||0)+t.value);return Array.from(e.entries()).map(e=>{let[t,l]=e;return{time:t,value:l,category:R}}).sort((e,t)=>C()(e.time).valueOf()-C()(t.time).valueOf())},[w]),F=(0,f.useMemo)(()=>{let e=A.slice(0,10);return 0===E.length?e:[R,...e]},[A,E]),k=(0,f.useMemo)(()=>0===A.length?[]:0===E.length?A:[R,...A],[A,E]),I=(0,f.useMemo)(()=>w.length||E.length?[...w,...E]:[],[w,E]);g.current=F;let L=e=>{if(!(null==e?void 0:e.data)||!e.dict)return 0;let t=0;for(let l of e.data){let a=0;for(let[t,r]of l.data){if("_total"===e.dict[t]){a=r;break}a+=r}t+=a}return t},q=(0,f.useMemo)(()=>L(x),[x]),B=(0,f.useMemo)(()=>L(b),[b]),_=(0,f.useMemo)(()=>{if(!w.length)return{total:0,categories:new Map};let e=0,t=new Map;for(let l of w){e+=l.value;let a=t.get(l.category)||0;t.set(l.category,a+l.value)}return{total:e,categories:t}},[w]),G=(0,f.useMemo)(()=>Array.from(_.categories.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10),[_.categories]),K={interaction:{legendFilter:!0,tooltip:{shared:!0}},data:I,xField:e=>new Date(e.time),yField:"value",colorField:"category",shapeField:"smooth",axis:{x:{title:"时间",labelAutoRotate:!0,labelFormatter:e=>{let t=C()(e);return t.isValid()?t.format("MM/DD HH:mm"):e}},y:{title:T[l]}},tooltip:{channel:"y"},legend:{position:"top"},scale:k.length?{color:{domain:k}}:void 0,onReady:e=>{let{chart:t}=e;try{t.on("afterrender",()=>{let e=g.current;e.length&&t.emit("legend:filter",{data:{channel:"color",values:e}})})}catch(e){console.error(e)}},height:480};return(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)(o.A,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)(D,{level:4,className:"m-0!",children:"全局数据统计"}),(0,a.jsxs)(c.A,{children:[(0,a.jsxs)(u.A.Group,{value:l,onChange:e=>s(e.target.value),children:[(0,a.jsx)(u.A.Button,{value:"pv",children:"请求数"}),(0,a.jsx)(u.A.Button,{value:"uv",children:"用户数"})]}),(0,a.jsx)(d.A,{placeholder:"筛选 Key",showSearch:{optionFilterProp:"label"},value:i,options:H,onChange:e=>p(e),className:"w-40"}),(0,a.jsx)(O,{showTime:!0,value:e,onChange:e=>{(null==e?void 0:e[0])&&e[1]&&t([e[0],e[1]])},presets:[{label:"过去1小时",value:[C()().subtract(1,"hour"),C()()]},{label:"过去6小时",value:[C()().subtract(6,"hour"),C()()]},{label:"过去24小时",value:[C()().subtract(24,"hour"),C()()]},{label:"过去7天",value:[C()().subtract(7,"day"),C()()]},{label:"过去30天",value:[C()().subtract(30,"day"),C()()]}]})]})]}),(0,a.jsxs)(m.A,{spinning:"pv"===l?y:$,children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsx)(o.A,{size:"small",children:(0,a.jsx)(N,{title:"总请求数",value:y?"-":q.toLocaleString()})}),(0,a.jsx)(o.A,{size:"small",children:(0,a.jsx)(N,{title:"总用户数",value:$?"-":B.toLocaleString()})})]}),(0,a.jsx)(o.A,{size:"small",style:{marginBottom:20},children:I.length>0?(0,a.jsx)(r.A,{...K}):(0,a.jsx)("div",{className:"h-80 flex items-center justify-center text-gray-400",children:"暂无数据"})}),G.length>0&&(0,a.jsx)(o.A,{title:"分类统计 (Top 10)",size:"small",children:(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:G.map(e=>{let[t,l]=e;return(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate",title:t,children:t}),(0,a.jsx)("div",{className:"text-lg font-semibold",children:l.toLocaleString()})]},t)})})})]})]})})}}}]);