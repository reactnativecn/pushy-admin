"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["150"],{6413(e,t,s){s.r(t),s.d(t,{Component:()=>M});var i=s(4848),a=s(4022),r=s(6385),n=s(4811),l=s(7665),o=s(2454),u=s(5419),d=s(6287),c=s(6380),h=s(1215),m=s(3133),p=s(400),y=s(4840),x=s(8361),b=s(8032),A=s(8424),j=s(6615),f=s(8448),v=s(4353),g=s.n(v),w=s(6540),I=s(391);let{Title:k}=d.A,M=()=>{let e=(0,l.jE)(),[t,s]=(0,w.useState)(""),[d,v]=(0,w.useState)(""),[M,O]=(0,w.useState)(!1),[C,N]=(0,w.useState)(null),[S]=c.A.useForm();(0,w.useEffect)(()=>{let e=setTimeout(()=>v(t),300);return()=>clearTimeout(e)},[t]);let{data:K,isLoading:R}=(0,o.I)({queryKey:["adminApps",d],queryFn:()=>I.F.searchApps(d||void 0)}),E=(0,u.n)({mutationFn:e=>{let{id:t,data:s}=e;return I.F.updateApp(t,s)},onSuccess:()=>{h.Ay.success("应用信息已更新"),O(!1),e.invalidateQueries({queryKey:["adminApps"]})},onError:e=>{h.Ay.error(e.message)}}),T=async()=>{try{let e=await S.validateFields();if(!C)return;let t={name:e.name,platform:e.platform,userId:e.userId||null,downloadUrl:e.downloadUrl||null,status:e.status||null,ignoreBuildTime:e.ignoreBuildTime||null};E.mutate({id:C.id,data:t})}catch(e){h.Ay.error(e.message)}},U=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"名称",dataIndex:"name",key:"name",width:150},{title:"App Key",dataIndex:"appKey",key:"appKey",width:200,render:e=>(0,i.jsxs)(m.A,{children:[(0,i.jsx)("span",{className:"font-mono text-xs",children:e}),(0,i.jsx)(p.Ay,{type:"text",size:"small",icon:(0,i.jsx)(a.A,{}),onClick:()=>{navigator.clipboard.writeText(e),h.Ay.success("已复制")}})]})},{title:"平台",dataIndex:"platform",key:"platform",width:80,render:e=>(0,i.jsx)("span",{className:"ios"===e?"text-blue-600":"android"===e?"text-green-600":"text-orange-600",children:e})},{title:"用户ID",dataIndex:"userId",key:"userId",width:80},{title:"状态",dataIndex:"status",key:"status",width:80,render:e=>e||"-"},{title:"忽略构建时间",dataIndex:"ignoreBuildTime",key:"ignoreBuildTime",width:120,render:e=>(0,i.jsx)("span",{className:"enabled"===e?"text-green-600":"",children:"enabled"===e?"是":"disabled"===e?"否":"-"})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>e?g()(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"操作",key:"action",width:80,render:(e,t)=>(0,i.jsx)(p.Ay,{type:"link",icon:(0,i.jsx)(r.A,{}),onClick:()=>{N(t),S.setFieldsValue({name:t.name,platform:t.platform,userId:t.userId,downloadUrl:t.downloadUrl||"",status:t.status||"",ignoreBuildTime:t.ignoreBuildTime}),O(!0)},children:"编辑"})}];return(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)(y.A,{children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(k,{level:4,className:"m-0!",children:"应用管理"}),(0,i.jsx)(x.A,{placeholder:"搜索应用名称或 App Key",prefix:(0,i.jsx)(n.A,{}),value:t,onChange:e=>s(e.target.value),style:{width:300},allowClear:!0})]}),(0,i.jsx)(b.A,{spinning:R,children:(0,i.jsx)(A.A,{dataSource:(null==K?void 0:K.data)||[],columns:U,rowKey:"id",pagination:{pageSize:20},scroll:{x:1e3}})})]}),(0,i.jsx)(j.A,{title:`编辑应用: ${null==C?void 0:C.name}`,open:M,onCancel:()=>O(!1),footer:[(0,i.jsx)(p.Ay,{onClick:()=>O(!1),children:"取消"},"cancel"),(0,i.jsx)(p.Ay,{type:"primary",loading:E.isPending,onClick:T,children:"保存"},"save")],width:600,children:(0,i.jsx)(c.A,{form:S,layout:"vertical",className:"mt-4",children:(0,i.jsxs)(m.A,{className:"w-full",direction:"vertical",size:"middle",children:[(0,i.jsx)(c.A.Item,{name:"name",label:"名称",className:"mb-0!",rules:[{required:!0}],children:(0,i.jsx)(x.A,{})}),(0,i.jsx)(c.A.Item,{name:"platform",label:"平台",className:"mb-0!",children:(0,i.jsx)(f.A,{options:[{value:"ios",label:"iOS"},{value:"android",label:"Android"},{value:"harmony",label:"HarmonyOS"}]})}),(0,i.jsx)(c.A.Item,{name:"userId",label:"用户ID",className:"mb-0!",children:(0,i.jsx)(x.A,{type:"number",placeholder:"留空表示无归属"})}),(0,i.jsx)(c.A.Item,{name:"downloadUrl",label:"下载链接",className:"mb-0!",children:(0,i.jsx)(x.A,{placeholder:"应用商店链接"})}),(0,i.jsx)(c.A.Item,{name:"status",label:"状态",className:"mb-0!",children:(0,i.jsx)(x.A,{placeholder:"自定义状态"})}),(0,i.jsx)(c.A.Item,{name:"ignoreBuildTime",label:"忽略构建时间",className:"mb-0!",children:(0,i.jsx)(f.A,{allowClear:!0,options:[{value:"enabled",label:"启用"},{value:"disabled",label:"禁用"}]})})]})})})]})}},5419(e,t,s){s.d(t,{n:()=>d});var i=s(6540),a=s(6158),r=s(6261),n=s(6500),l=s(4880),o=class extends n.Q{#e;#t=void 0;#s;#i;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,l.f8)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,l.EN)(t.mutationKey)!==(0,l.EN)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#a(),this.#r(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#r()}mutate(e,t){return this.#i=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#a(){let e=this.#s?.state??(0,a.$)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#r(e){r.jG.batch(()=>{if(this.#i&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#i.onSuccess?.(e.data,t,s,i)}catch(e){Promise.reject(e)}try{this.#i.onSettled?.(e.data,null,t,s,i)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#i.onError?.(e.error,t,s,i)}catch(e){Promise.reject(e)}try{this.#i.onSettled?.(void 0,e.error,t,s,i)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#t)})})}},u=s(7665);function d(e,t){let s=(0,u.jE)(t),[a]=i.useState(()=>new o(s,e));i.useEffect(()=>{a.setOptions(e)},[a,e]);let n=i.useSyncExternalStore(i.useCallback(e=>a.subscribe(r.jG.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=i.useCallback((e,t)=>{a.mutate(e,t).catch(l.lQ)},[a]);if(n.error&&(0,l.GU)(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:d,mutateAsync:n.mutate}}}}]);