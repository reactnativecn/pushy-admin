"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["484"],{5335(e,n,t){t.r(n),t.d(n,{Component:()=>N});var r=t(4848),s=t(6029),a=t(8623),i=t(156),l=t(7665),c=t(2454),d=t(6287),u=t(6380),o=t(1215),y=t(3133),p=t(400),h=t(5021),m=t(4840),x=t(8032),g=t(8424),A=t(6615),j=t(8361),f=t(6540),v=t(271),k=t(7762);let{Title:C}=d.A,S=e=>{let{value:n,onChange:t}=e,s=(0,f.useRef)(null),a=(0,f.useRef)(null);return(0,f.useEffect)(()=>(s.current&&!a.current&&(a.current=new v.uL({target:s.current,props:{content:{text:n},onChange:(e,n,r)=>{let{contentErrors:s}=r;!s&&("json"in e&&void 0!==e.json?t(JSON.stringify(e.json,null,2)):"text"in e&&t(e.text))},mode:"text"}})),()=>{a.current&&(a.current.destroy(),a.current=null)}),[]),(0,f.useEffect)(()=>{a.current&&a.current.update({text:n})},[n]),(0,r.jsx)("div",{ref:s,style:{height:300}})},N=()=>{let e=(0,l.jE)(),[n,t]=(0,f.useState)(!1),[d,v]=(0,f.useState)(null),[N]=u.A.useForm(),[w,b]=(0,f.useState)(""),{data:I,isLoading:O,refetch:J}=(0,c.I)({queryKey:["adminConfig"],queryFn:()=>k.i.getConfig()}),$=(null==I?void 0:I.data)?Object.entries(I.data).map(e=>{let[n,t]=e;return{key:n,value:t}}):[],F=async()=>{try{let n,r=(await N.validateFields()).key;try{n=JSON.parse(w)}catch{o.Ay.error("请输入有效的 JSON 格式");return}let s=JSON.stringify(n);await k.i.setConfig(r,s),o.Ay.success("保存成功"),t(!1),e.invalidateQueries({queryKey:["adminConfig"]})}catch(e){o.Ay.error(e.message)}},K=(0,f.useCallback)(async e=>{try{await k.i.deleteConfig(e),o.Ay.success("已删除"),J()}catch(e){o.Ay.error(e.message)}},[J]),R=[{title:"Key",dataIndex:"key",key:"key",width:200},{title:"Value",dataIndex:"value",key:"value",render:e=>{try{let n=JSON.parse(e);return(0,r.jsx)("pre",{className:"m-0 max-h-24 overflow-auto text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(n,null,2)})}catch{return(0,r.jsx)("span",{className:"text-gray-600",children:e})}}},{title:"操作",key:"action",width:150,render:(e,n)=>(0,r.jsxs)(y.A,{children:[(0,r.jsx)(p.Ay,{type:"link",onClick:()=>(e=>{v(e),N.setFieldsValue({key:e.key});try{b(JSON.stringify(JSON.parse(e.value),null,2))}catch{b(e.value)}t(!0)})(n),children:"编辑"}),(0,r.jsx)(h.A,{title:"确定删除此配置？",onConfirm:()=>K(n.key),children:(0,r.jsx)(p.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(s.A,{})})})]})}];return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)(m.A,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(C,{level:4,className:"m-0!",children:"动态配置管理"}),(0,r.jsx)(p.Ay,{type:"primary",icon:(0,r.jsx)(a.A,{}),onClick:()=>{v(null),N.resetFields(),b(""),t(!0)},children:"添加配置"})]}),(0,r.jsx)(x.A,{spinning:O,children:(0,r.jsx)(g.A,{dataSource:$,columns:R,rowKey:"key",pagination:!1})})]}),(0,r.jsx)(A.A,{title:d?"编辑配置":"添加配置",open:n,onCancel:()=>t(!1),footer:[(0,r.jsx)(p.Ay,{onClick:()=>t(!1),children:"取消"},"cancel"),(0,r.jsx)(p.Ay,{type:"primary",icon:(0,r.jsx)(i.A,{}),onClick:F,children:"保存"},"save")],width:700,children:(0,r.jsxs)(u.A,{form:N,layout:"vertical",children:[(0,r.jsx)(u.A.Item,{name:"key",label:"Key",rules:[{required:!0,message:"请输入配置键名"}],children:(0,r.jsx)(j.A,{disabled:!!d,placeholder:"配置键名"})}),(0,r.jsx)(u.A.Item,{label:"Value (JSON)",children:(0,r.jsx)(S,{value:w,onChange:b})})]})})]})}},7762(e,n,t){t.d(n,{i:()=>s});var r=t(6126);let s={getConfig:()=>(0,r.Ay)("get","/admin/config"),setConfig:(e,n)=>(0,r.Ay)("post","/admin/config",{key:e,value:n}),deleteConfig:e=>(0,r.Ay)("delete",`/admin/config/${e}`),searchUsers:e=>(0,r.Ay)("get",e?`/admin/users?search=${encodeURIComponent(e)}`:"/admin/users"),updateUser:(e,n)=>(0,r.Ay)("put",`/admin/users/${e}`,n),searchApps:e=>(0,r.Ay)("get",e?`/admin/apps?search=${encodeURIComponent(e)}`:"/admin/apps"),searchVersions:e=>{let n=new URLSearchParams;(null==e?void 0:e.search)&&n.set("search",e.search),(null==e?void 0:e.appId)&&n.set("appId",String(e.appId));let t=n.toString();return(0,r.Ay)("get",t?`/admin/versions?${t}`:"/admin/versions")},updateVersion:(e,n)=>(0,r.Ay)("put",`/admin/versions/${e}`,n),updateApp:(e,n)=>(0,r.Ay)("put",`/admin/apps/${e}`,n)}}}]);