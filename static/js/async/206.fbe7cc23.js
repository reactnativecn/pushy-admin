/*! For license information please see 206.fbe7cc23.js.LICENSE.txt */
"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["206"],{9781(e,t,n){n.r(t),n.d(t,{Component:()=>M});var r=n(4848),l=n(6029),a=n(8623),s=n(6540);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var c=n(5973);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let m=s.forwardRef((e,t)=>s.createElement(c.A,o({},e,{ref:t,icon:i})));var u=n(7665),d=n(2454),p=n(998),y=n(6380),f=n(1215),h=n(3133),x=n(400),g=n(1399),v=n(8248),A=n(4164),j=n(5541),C=n(2279),N=n(8073),k=n(8875),w=n(8431),b=n(7755),E=n(1861),O=n(9449),$=n(9155),S=n(2071),F=n(5381);let I=(0,n(7358).OF)("Popconfirm",e=>(e=>{let{componentCls:t,iconCls:n,antCls:r,zIndexPopup:l,colorText:a,colorWarning:s,marginXXS:i,marginXS:c,fontSize:o,fontWeightStrong:m,colorTextHeading:u}=e;return{[t]:{zIndex:l,[`&${r}-popover`]:{fontSize:o},[`${t}-message`]:{marginBottom:c,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${n}`]:{color:s,fontSize:o,lineHeight:1,marginInlineEnd:c},[`${t}-title`]:{fontWeight:m,color:u,"&:only-child":{fontWeight:"normal"}},[`${t}-description`]:{marginTop:i,color:a}},[`${t}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:c}}}}})(e),e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}},{resetStyle:!1}),V=e=>{let{prefixCls:t,okButtonProps:n,cancelButtonProps:r,title:l,description:a,cancelText:i,okText:c,okType:o="primary",icon:m=s.createElement(g.A,null),showCancel:u=!0,close:d,onConfirm:p,onCancel:y,onPopupClick:f,classNames:h,styles:x}=e,{getPrefixCls:v}=s.useContext(C.QO),[j]=(0,$.A)("Popconfirm",S.A.Popconfirm),N=(0,b.b)(l),k=(0,b.b)(a);return s.createElement("div",{className:`${t}-inner-content`,onClick:f},s.createElement("div",{className:`${t}-message`},m&&s.createElement("span",{className:`${t}-message-icon`},m),s.createElement("div",{className:`${t}-message-text`},N&&s.createElement("div",{className:(0,A.$)(`${t}-title`,h?.title),style:x?.title},N),k&&s.createElement("div",{className:(0,A.$)(`${t}-description`,h?.content),style:x?.content},k))),s.createElement("div",{className:`${t}-buttons`},u&&s.createElement(E.A,{onClick:y,size:"small",...r},i||j?.cancelText),s.createElement(w.A,{buttonProps:{size:"small",...(0,O.DU)(o),...n},actionFn:p,close:d,prefixCls:v("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},c||j?.okText)))},J=s.forwardRef((e,t)=>{let{prefixCls:n,placement:r="top",trigger:l,okType:a="primary",icon:i=s.createElement(g.A,null),children:c,overlayClassName:o,onOpenChange:m,overlayStyle:u,styles:d,arrow:p,classNames:y,...f}=e,{getPrefixCls:h,className:x,style:w,classNames:b,styles:E,arrow:O,trigger:$}=(0,C.TP)("popconfirm"),[S,F]=(0,v.PW)(e.defaultOpen??!1,e.open),J=(0,k.A)(p,O),z=l||$||"click",P=(e,t)=>{F(e),m?.(e,t)},q=h("popconfirm",n),K={...e,placement:r,trigger:z,okType:a,overlayStyle:u,styles:d,classNames:y},[R,T]=(0,j.AV)([b,y],[E,d],{props:K}),W=(0,A.$)(q,x,o,R.root);return I(q),s.createElement(N.A,{arrow:J,...(0,v.cJ)(f,["title"]),trigger:z,placement:r,onOpenChange:(t,n)=>{let{disabled:r=!1}=e;r||P(t,n)},open:S,ref:t,classNames:{root:W,container:R.container,arrow:R.arrow},styles:{root:{...w,...T.root,...u},container:T.container,arrow:T.arrow},content:s.createElement(V,{okType:a,icon:i,...e,prefixCls:q,close:e=>{P(!1,e)},onConfirm:t=>e.onConfirm?.call(void 0,t),onCancel:t=>{P(!1,t),e.onCancel?.call(void 0,t)},classNames:R,styles:T}),"data-popover-inject":!0},c)});J._InternalPanelDoNotUseOrYouWillBeFired=e=>{let{prefixCls:t,placement:n,className:r,style:l,...a}=e,{getPrefixCls:i}=s.useContext(C.QO),c=i("popconfirm",t);return I(c),s.createElement(F.Ay,{placement:n,className:(0,A.$)(c,r),style:l,content:s.createElement(V,{prefixCls:c,...a})})};var z=n(4840),P=n(8032),q=n(7130),K=n(6615),R=n(8361),T=n(271),W=n(391);let{Title:H}=p.A,B=e=>{let{value:t,onChange:n}=e,l=(0,s.useRef)(null),a=(0,s.useRef)(null);return(0,s.useEffect)(()=>(l.current&&!a.current&&(a.current=new T.uL({target:l.current,props:{content:{text:t},onChange:(e,t,r)=>{let{contentErrors:l}=r;!l&&("json"in e&&void 0!==e.json?n(JSON.stringify(e.json,null,2)):"text"in e&&n(e.text))},mode:"text"}})),()=>{a.current&&(a.current.destroy(),a.current=null)}),[]),(0,s.useEffect)(()=>{a.current&&a.current.update({text:t})},[t]),(0,r.jsx)("div",{ref:l,style:{height:300}})},M=()=>{let e=(0,u.jE)(),[t,n]=(0,s.useState)(!1),[i,c]=(0,s.useState)(null),[o]=y.A.useForm(),[p,g]=(0,s.useState)(""),{data:v,isLoading:A,refetch:j}=(0,d.I)({queryKey:["adminConfig"],queryFn:()=>W.F.getAdminConfig()}),C=(null==v?void 0:v.data)?Object.entries(v.data).map(e=>{let[t,n]=e;return{key:t,value:n}}):[],N=async()=>{try{let t,r=(await o.validateFields()).key;try{t=JSON.parse(p)}catch{f.Ay.error("请输入有效的 JSON 格式");return}let l=JSON.stringify(t);await W.F.setAdminConfig(r,l),f.Ay.success("保存成功"),n(!1),e.invalidateQueries({queryKey:["adminConfig"]})}catch(e){f.Ay.error(e.message)}},k=(0,s.useCallback)(async e=>{try{await W.F.deleteAdminConfig(e),f.Ay.success("已删除"),j()}catch(e){f.Ay.error(e.message)}},[j]),w=[{title:"Key",dataIndex:"key",key:"key",width:200},{title:"Value",dataIndex:"value",key:"value",render:e=>{try{let t=JSON.parse(e);return(0,r.jsx)("pre",{className:"m-0 max-h-24 overflow-auto text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(t,null,2)})}catch{return(0,r.jsx)("span",{className:"text-gray-600",children:e})}}},{title:"操作",key:"action",width:150,render:(e,t)=>(0,r.jsxs)(h.A,{children:[(0,r.jsx)(x.Ay,{type:"link",onClick:()=>(e=>{c(e),o.setFieldsValue({key:e.key});try{g(JSON.stringify(JSON.parse(e.value),null,2))}catch{g(e.value)}n(!0)})(t),children:"编辑"}),(0,r.jsx)(J,{title:"确定删除此配置？",onConfirm:()=>k(t.key),children:(0,r.jsx)(x.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(l.A,{})})})]})}];return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)(z.A,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(H,{level:4,className:"m-0!",children:"动态配置管理"}),(0,r.jsx)(x.Ay,{type:"primary",icon:(0,r.jsx)(a.A,{}),onClick:()=>{c(null),o.resetFields(),g(""),n(!0)},children:"添加配置"})]}),(0,r.jsx)(P.A,{spinning:A,children:(0,r.jsx)(q.A,{dataSource:C,columns:w,rowKey:"key",pagination:!1})})]}),(0,r.jsx)(K.A,{title:i?"编辑配置":"添加配置",open:t,onCancel:()=>n(!1),footer:[(0,r.jsx)(x.Ay,{onClick:()=>n(!1),children:"取消"},"cancel"),(0,r.jsx)(x.Ay,{type:"primary",icon:(0,r.jsx)(m,{}),onClick:N,children:"保存"},"save")],width:700,children:(0,r.jsxs)(y.A,{form:o,layout:"vertical",children:[(0,r.jsx)(y.A.Item,{name:"key",label:"Key",rules:[{required:!0,message:"请输入配置键名"}],children:(0,r.jsx)(R.A,{disabled:!!i,placeholder:"配置键名"})}),(0,r.jsx)(y.A.Item,{label:"Value (JSON)",children:(0,r.jsx)(B,{value:p,onChange:g})})]})})]})}}}]);