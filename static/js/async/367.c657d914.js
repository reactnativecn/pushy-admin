/*! For license information please see 367.c657d914.js.LICENSE.txt */
"use strict";(self.webpackChunkpushy_admin=self.webpackChunkpushy_admin||[]).push([["367"],{8298(e,t,n){n.r(t),n.d(t,{Component:()=>O});var r=n(4848),s=n(6029),a=n(8623),i=n(6540);let l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var c=n(4302);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let o=i.forwardRef((e,t)=>i.createElement(c.A,d({},e,{ref:t,icon:l})));var u=n(7665),y=n(2454),p=n(6287),h=n(6380),m=n(1215),g=n(3133),f=n(400),x=n(5021),A=n(4840),j=n(8032),v=n(8424),k=n(2837),C=n(8361),w=n(271),S=n(7762);let{Title:b}=p.A,N=e=>{let{value:t,onChange:n}=e,s=(0,i.useRef)(null),a=(0,i.useRef)(null);return(0,i.useEffect)(()=>(s.current&&!a.current&&(a.current=new w.uL({target:s.current,props:{content:{text:t},onChange:(e,t,r)=>{let{contentErrors:s}=r;!s&&("json"in e&&void 0!==e.json?n(JSON.stringify(e.json,null,2)):"text"in e&&n(e.text))},mode:"text"}})),()=>{a.current&&(a.current.destroy(),a.current=null)}),[]),(0,i.useEffect)(()=>{a.current&&a.current.update({text:t})},[t]),(0,r.jsx)("div",{ref:s,style:{height:300}})},O=()=>{let e=(0,u.jE)(),[t,n]=(0,i.useState)(!1),[l,c]=(0,i.useState)(null),[d]=h.A.useForm(),[p,w]=(0,i.useState)(""),{data:O,isLoading:V,refetch:I}=(0,y.I)({queryKey:["adminConfig"],queryFn:()=>S.i.getConfig()}),J=(null==O?void 0:O.data)?Object.entries(O.data).map(e=>{let[t,n]=e;return{key:t,value:n}}):[],$=async()=>{try{let t,r=(await d.validateFields()).key;try{t=JSON.parse(p)}catch{m.Ay.error("请输入有效的 JSON 格式");return}let s=JSON.stringify(t);await S.i.setConfig(r,s),m.Ay.success("保存成功"),n(!1),e.invalidateQueries({queryKey:["adminConfig"]})}catch(e){m.Ay.error(e.message)}},R=(0,i.useCallback)(async e=>{try{await S.i.deleteConfig(e),m.Ay.success("已删除"),I()}catch(e){m.Ay.error(e.message)}},[I]),z=[{title:"Key",dataIndex:"key",key:"key",width:200},{title:"Value",dataIndex:"value",key:"value",render:e=>{try{let t=JSON.parse(e);return(0,r.jsx)("pre",{className:"m-0 max-h-24 overflow-auto text-xs bg-gray-100 p-2 rounded",children:JSON.stringify(t,null,2)})}catch{return(0,r.jsx)("span",{className:"text-gray-600",children:e})}}},{title:"操作",key:"action",width:150,render:(e,t)=>(0,r.jsxs)(g.A,{children:[(0,r.jsx)(f.Ay,{type:"link",onClick:()=>(e=>{c(e),d.setFieldsValue({key:e.key});try{w(JSON.stringify(JSON.parse(e.value),null,2))}catch{w(e.value)}n(!0)})(t),children:"编辑"}),(0,r.jsx)(x.A,{title:"确定删除此配置？",onConfirm:()=>R(t.key),children:(0,r.jsx)(f.Ay,{type:"link",danger:!0,icon:(0,r.jsx)(s.A,{})})})]})}];return(0,r.jsxs)("div",{className:"page-section",children:[(0,r.jsxs)(A.A,{children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-4",children:[(0,r.jsx)(b,{level:4,className:"m-0!",children:"动态配置管理"}),(0,r.jsx)(f.Ay,{type:"primary",icon:(0,r.jsx)(a.A,{}),onClick:()=>{c(null),d.resetFields(),w(""),n(!0)},className:"w-full md:w-auto",children:"添加配置"})]}),(0,r.jsx)(j.A,{spinning:V,children:(0,r.jsx)(v.A,{dataSource:J,columns:z,rowKey:"key",pagination:!1,scroll:{x:720}})})]}),(0,r.jsx)(k.A,{title:l?"编辑配置":"添加配置",open:t,onCancel:()=>n(!1),footer:[(0,r.jsx)(f.Ay,{onClick:()=>n(!1),children:"取消"},"cancel"),(0,r.jsx)(f.Ay,{type:"primary",icon:(0,r.jsx)(o,{}),onClick:$,children:"保存"},"save")],width:700,children:(0,r.jsxs)(h.A,{form:d,layout:"vertical",children:[(0,r.jsx)(h.A.Item,{name:"key",label:"Key",rules:[{required:!0,message:"请输入配置键名"}],children:(0,r.jsx)(C.A,{disabled:!!l,placeholder:"配置键名"})}),(0,r.jsx)(h.A.Item,{label:"Value (JSON)",children:(0,r.jsx)(N,{value:p,onChange:w})})]})})]})}},7762(e,t,n){n.d(t,{i:()=>s});var r=n(6126);let s={getConfig:()=>(0,r.Ay)("get","/admin/config"),setConfig:(e,t)=>(0,r.Ay)("post","/admin/config",{key:e,value:t}),deleteConfig:e=>(0,r.Ay)("delete",`/admin/config/${e}`),searchUsers:e=>(0,r.Ay)("get",e?`/admin/users?search=${encodeURIComponent(e)}`:"/admin/users"),updateUser:(e,t)=>(0,r.Ay)("put",`/admin/users/${e}`,t),searchApps:e=>(0,r.Ay)("get",e?`/admin/apps?search=${encodeURIComponent(e)}`:"/admin/apps"),searchVersions:e=>{let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.appId)&&t.set("appId",String(e.appId));let n=t.toString();return(0,r.Ay)("get",n?`/admin/versions?${n}`:"/admin/versions")},updateVersion:(e,t)=>(0,r.Ay)("put",`/admin/versions/${e}`,t),updateApp:(e,t)=>(0,r.Ay)("put",`/admin/apps/${e}`,t)}}}]);